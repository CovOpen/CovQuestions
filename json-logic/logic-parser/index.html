<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>JSON Logic Converter</title>
		<script type="text/javascript">
			var expression=function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=r,e.c=t,e.d=function(r,t,n){e.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:n})},e.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,t){if(1&t&&(r=e(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var i in r)e.d(n,i,function(t){return r[t]}.bind(null,i));return n},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},e.p="",e(e.s=0)}([function(r,t,e){"use strict";t.__esModule=!0;var n=e(1);function i(r,t){if("("!=r[t])throw new Error("No '(' at index "+t);for(var e=1,n=t+1;n<r.length;n++)switch(r[n]){case"(":e++;break;case")":if(0==--e)return n}return-1}function u(r){if("null"==r)return null;if("true"==r)return!0;if("false"==r)return!1;try{var t=parseFloat(r);if(!Number.isNaN(t))return t}catch(r){}return r}var o=function(){function r(r,t){void 0===t&&(t=1),this.subExpressions={},this.depth=t,this.raw=r,this.parsed=r,this.parse()}return r.prototype.parse=function(){for(var t=0,e=0;e<this.raw.length;e++)if("("==this.raw[e]){var n=e,u=i(this.raw,n);if(u>0){var o=this.raw.substring(n+1,u),a="#EXPR"+this.depth+"#"+t+"#";this.subExpressions[a]={start:n,end:u,expr:new r(o,this.depth+1+t)},this.parsed=this.parsed.replace(o,a),t+=1,e=u}}},r.prototype.toJSONLogic=function(){var r=this.parsed.replace(/\+/g," + ").replace(/\-\s/g," - ").replace(/\*/g," * ").replace(/\//g," / ").replace(/\%/g," % ").replace(/\</g," < ").replace(/\>/g," > ").replace(/\<\s\=/g,"<=").replace(/\>\s\=/g,">=").replace(/\=\=/g," == ").replace(/\!\=/g," != ").replace(/\,\s/g,",").replace(/\s\,/g,",").split(" ").filter((function(r){return r.length>0})).map((function(r){return-1==r.indexOf(".")&&-1==r.indexOf("#")?r.toLowerCase():r}));return this.chain(r)},r.prototype.checkExpression=function(r){var t=this,e=r;if("string"==typeof e&&r.startsWith("[")&&r.endsWith("]"))return e.slice(1,-1).split(",").filter((function(r){return r.length>0})).map((function(r){return t.checkExpression(r)}));if("string"==typeof e&&r.startsWith("(#")&&r.endsWith("#)"))return this.subExpressions[r.slice(1,-1)].expr.toJSONLogic();if("string"==typeof e&&e.startsWith("!"))return{"!":this.checkExpression(e.slice(1))};if("string"==typeof e&&e.startsWith("-"))return{"-":this.checkExpression(e.slice(1))};if("string"==typeof e&&e.indexOf(".")>0){var n=e.indexOf(".");if(Number.isNaN(parseFloat(e[n+1]))){var i=null,o=e;if(e.indexOf(":")>0){var a=e.split(":");o=a[0],i=u(a[1])}return{var:[o,i]}}}return"string"==typeof e?u(e):e},r.prototype.chain=function(r){var t,e,n,i;if(1==r.length)return this.checkExpression(r[0]);if(2==r.length&&("max"==r[0]||"min"==r[0]||"+"==r[0]||"*"==r[0])){var u=this.checkExpression(r[1]);return(t={})[r[0]]=u,t}if(3==r.length){var o=this.checkExpression(r[0]),a=this.checkExpression(r[2]);return(e={})[r[1]]=[o,a],e}if(!(5!=r.length||"<"!=r[1]&&"<="!=r[1]&&">"!=r[1]&&">="!=r[1]||"<"!=r[3]&&"<="!=r[3]&&">"!=r[1]&&">="!=r[1])){o=this.checkExpression(r[0]),a=this.checkExpression(r[2]);var s=this.checkExpression(r[4]);return(n={})[r[1]]=[o,a,s],n}return 6==r.length&&"if"==r[0]&&"then"==r[2]&&"else"==r[4]?{if:[this.checkExpression(r[1]),this.checkExpression(r[3]),this.checkExpression(r[5])]}:((i={})[r[1]]=[this.checkExpression(r[0]),this.chain(r.slice(2))],i)},r}();t.Expression=o,t.evaluateExpression=function(r){return new o(r).toJSONLogic()},t.evaluateJSONLogic=function(r,t){return n.apply(r,t)}},function(r,t,e){var n,i;void 0===(i="function"==typeof(n=function(){"use strict";Array.isArray||(Array.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)});var r={},t={"==":function(r,t){return r==t},"===":function(r,t){return r===t},"!=":function(r,t){return r!=t},"!==":function(r,t){return r!==t},">":function(r,t){return r>t},">=":function(r,t){return r>=t},"<":function(r,t,e){return void 0===e?r<t:r<t&&t<e},"<=":function(r,t,e){return void 0===e?r<=t:r<=t&&t<=e},"!!":function(t){return r.truthy(t)},"!":function(t){return!r.truthy(t)},"%":function(r,t){return r%t},log:function(r){return console.log(r),r},in:function(r,t){return!(!t||void 0===t.indexOf)&&-1!==t.indexOf(r)},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(r,t,e){if(e<0){var n=String(r).substr(t);return n.substr(0,n.length+e)}return String(r).substr(t,e)},"+":function(){return Array.prototype.reduce.call(arguments,(function(r,t){return parseFloat(r,10)+parseFloat(t,10)}),0)},"*":function(){return Array.prototype.reduce.call(arguments,(function(r,t){return parseFloat(r,10)*parseFloat(t,10)}))},"-":function(r,t){return void 0===t?-r:r-t},"/":function(r,t){return r/t},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,(function(r,t){return r.concat(t)}),[])},var:function(r,t){var e=void 0===t?null:t,n=this;if(void 0===r||""===r||null===r)return n;for(var i=String(r).split("."),u=0;u<i.length;u++){if(null===n)return e;if(void 0===(n=n[i[u]]))return e}return n},missing:function(){for(var t=[],e=Array.isArray(arguments[0])?arguments[0]:arguments,n=0;n<e.length;n++){var i=e[n],u=r.apply({var:i},this);null!==u&&""!==u||t.push(i)}return t},missing_some:function(t,e){var n=r.apply({missing:e},this);return e.length-n.length>=t?[]:n},method:function(r,t,e){return r[t].apply(r,e)}};return r.is_logic=function(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)&&1===Object.keys(r).length},r.truthy=function(r){return!(Array.isArray(r)&&0===r.length||!r)},r.get_operator=function(r){return Object.keys(r)[0]},r.get_values=function(t){return t[r.get_operator(t)]},r.apply=function(e,n){if(Array.isArray(e))return e.map((function(t){return r.apply(t,n)}));if(!r.is_logic(e))return e;n=n||{};var i,u,o,a,s,f=r.get_operator(e),c=e[f];if(Array.isArray(c)||(c=[c]),"if"===f||"?:"==f){for(i=0;i<c.length-1;i+=2)if(r.truthy(r.apply(c[i],n)))return r.apply(c[i+1],n);return c.length===i+1?r.apply(c[i],n):null}if("and"===f){for(i=0;i<c.length;i+=1)if(u=r.apply(c[i],n),!r.truthy(u))return u;return u}if("or"===f){for(i=0;i<c.length;i+=1)if(u=r.apply(c[i],n),r.truthy(u))return u;return u}if("filter"===f)return a=r.apply(c[0],n),o=c[1],Array.isArray(a)?a.filter((function(t){return r.truthy(r.apply(o,t))})):[];if("map"===f)return a=r.apply(c[0],n),o=c[1],Array.isArray(a)?a.map((function(t){return r.apply(o,t)})):[];if("reduce"===f)return a=r.apply(c[0],n),o=c[1],s=void 0!==c[2]?c[2]:null,Array.isArray(a)?a.reduce((function(t,e){return r.apply(o,{current:e,accumulator:t})}),s):s;if("all"===f){if(a=r.apply(c[0],n),o=c[1],!a.length)return!1;for(i=0;i<a.length;i+=1)if(!r.truthy(r.apply(o,a[i])))return!1;return!0}if("none"===f)return 0===r.apply({filter:c},n).length;if("some"===f)return r.apply({filter:c},n).length>0;if(c=c.map((function(t){return r.apply(t,n)})),"function"==typeof t[f])return t[f].apply(n,c);if(f.indexOf(".")>0){var p=String(f).split("."),l=t;for(i=0;i<p.length;i++)if(void 0===(l=l[p[i]]))throw new Error("Unrecognized operation "+f+" (failed at "+p.slice(0,i+1).join(".")+")");return l.apply(n,c)}throw new Error("Unrecognized operation "+f)},r.uses_data=function(t){var e=[];if(r.is_logic(t)){var n=r.get_operator(t),i=t[n];Array.isArray(i)||(i=[i]),"var"===n?e.push(i[0]):i.map((function(t){e.push.apply(e,r.uses_data(t))}))}return function(r){for(var t=[],e=0,n=r.length;e<n;e++)-1===t.indexOf(r[e])&&t.push(r[e]);return t}(e)},r.add_operation=function(r,e){t[r]=e},r.rm_operation=function(r){delete t[r]},r.rule_like=function(t,e){if(e===t)return!0;if("@"===e)return!0;if("number"===e)return"number"==typeof t;if("string"===e)return"string"==typeof t;if("array"===e)return Array.isArray(t)&&!r.is_logic(t);if(r.is_logic(e)){if(r.is_logic(t)){var n=r.get_operator(e),i=r.get_operator(t);if("@"===n||n===i)return r.rule_like(r.get_values(t,!1),r.get_values(e,!1))}return!1}if(Array.isArray(e)){if(Array.isArray(t)){if(e.length!==t.length)return!1;for(var u=0;u<e.length;u+=1)if(!r.rule_like(t[u],e[u]))return!1;return!0}return!1}return!1},r})?n.call(t,e,t,r):n)||(r.exports=i)}]);	
		</script>
		<script>
			function compileRawExpression() {
				const str = document.getElementById('raw-expression').value;
				const data = expression.evaluateExpression(str);
				document.getElementById('compiled-expression').value = JSON.stringify(data, null, 2);
			}

			function executeCompiledExpression() {
				const jsonLogic = JSON.parse(document.getElementById('compiled-expression').value);
				let data = null;
				try {
					data = JSON.parse(document.getElementById('sample-data').value);
				}
				catch {}
				result = expression.evaluateJSONLogic(jsonLogic, data);
				document.getElementById('sample-result').value = JSON.stringify(result, null, 2);
			}
		</script>
		<style>
			* {
  				box-sizing: border-box;
			}
			#wrapper {
				width: 100vw;
				position: relative;
				padding: 10px;
				display: flex;
				flex-direction: row;
			}
			#editor, #tryout {
				flex: 1 1 auto;
				padding: 10px;
				display: flex;
				flex-direction: column;
				height: 90vh;
				position: relative;
			}
			#editor {
				border-right-color: black;
				border-right-style: solid;
				border-right-width: 1px;
			}
			#editor > div, #tryout > div {
				flex: 1 1 auto;
			}

			.textarea-container {
				width: 100%;
				display: block;
				position: relative;
			}

			textarea {
				width: 100%;
				min-width: 100%;
				max-width: 100%;
				display: block;
			}

			#wrapper-compile-button, #wrapper-sample-button {
				flex-grow: 0;
				flex-shrink: 1;
			}

		</style>
	</head>
	<body>
		<div id="wrapper">
			<div id="editor">
				<div id="wrapper-raw-expression" class="textarea-container">
					<textarea id="raw-expression"></textarea>
				</div>
				<div id="wrapper-compile-button">
					<button type="button" onclick="compileRawExpression()">Compile</button>
				</div>
				<div id="wrapper-compiled-expression" class="textarea-container">
					<textarea id="compiled-expression"></textarea>
				</div>
			</div>
			<div id="tryout">
				<div id="wrapper-sample-data" class="textarea-container">
					<textarea id="sample-data"></textarea>
				</div>
				<div id="wrapper-sample-button">
					<button type="button" onclick="executeCompiledExpression()">Test</button>
				</div>
				<div id="wrapper-compiled-expression" class="textarea-container">
					<textarea id="sample-result"></textarea>
				</div>
			</div>
		</div>
	</body>
</html>